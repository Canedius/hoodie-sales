const salesData = [
  {
    "product": "Худі Утеплений Kufaika Unisex",
    "months": [
      {
        "month": "Січень",
        "colors": {
          "Чорний": [
            {"size": "M", "quantity": 267},
            {"size": "L", "quantity": 227},
            {"size": "XL", "quantity": 144},
            {"size": "S", "quantity": 83},
            {"size": "XXL", "quantity": 66},
            {"size": "XS", "quantity": 19},
            {"size": "3XL", "quantity": 16}
          ],
          "Білий": [
            {"size": "L", "quantity": 26},
            {"size": "M", "quantity": 23},
            {"size": "XL", "quantity": 16},
            {"size": "S", "quantity": 12},
            {"size": "XXL", "quantity": 2},
            {"size": "3XL", "quantity": 2},
            {"size": "XS", "quantity": 0}
          ],
          "Ніжно-рожевий": [
            {"size": "S", "quantity": 30},
            {"size": "M", "quantity": 23},
            {"size": "XS", "quantity": 13},
            {"size": "L", "quantity": 10},
            {"size": "XL", "quantity": 5},
            {"size": "XXL", "quantity": 3},
            {"size": "3XL", "quantity": 0}
          ],
          "Бежевий": [
            {"size": "L", "quantity": 14},
            {"size": "S", "quantity": 13},
            {"size": "M", "quantity": 13},
            {"size": "XS", "quantity": 10},
            {"size": "XL", "quantity": 8},
            {"size": "XXL", "quantity": 0},
            {"size": "3XL", "quantity": 0}
          ],
          "Олива": [
            {"size": "L", "quantity": 2},
            {"size": "M", "quantity": 1},
            {"size": "XL", "quantity": 1},
            {"size": "XXL", "quantity": 1},
            {"size": "XS", "quantity": 0},
            {"size": "S", "quantity": 0},
            {"size": "3XL", "quantity": 0}
          ],
          "Сірий Грі": [
            {"size": "M", "quantity": 36},
            {"size": "L", "quantity": 24},
            {"size": "S", "quantity": 19},
            {"size": "XL", "quantity": 17},
            {"size": "XXL", "quantity": 6},
            {"size": "XS", "quantity": 5},
            {"size": "3XL", "quantity": 1}
          ],
          "Хакі": [
            {"size": "M", "quantity": 52},
            {"size": "L", "quantity": 38},
            {"size": "XL", "quantity": 28},
            {"size": "S", "quantity": 22},
            {"size": "XXL", "quantity": 8},
            {"size": "XS", "quantity": 7},
            {"size": "3XL", "quantity": 2}
          ],
          "Інший Колір": [
            {"size": "XL", "quantity": 25},
            {"size": "M", "quantity": 13},
            {"size": "XXL", "quantity": 9},
            {"size": "L", "quantity": 8},
            {"size": "XS", "quantity": 0},
            {"size": "S", "quantity": 0},
            {"size": "3XL", "quantity": 0}
          ]
        }
      },
      {
        "month": "Лютий",
        "colors": {
          "Чорний": [
            {"size": "L", "quantity": 214},
            {"size": "M", "quantity": 190},
            {"size": "XL", "quantity": 130},
            {"size": "XXL", "quantity": 63},
            {"size": "S", "quantity": 54},
            {"size": "3XL", "quantity": 35},
            {"size": "XS", "quantity": 6}
          ],
          "Білий": [
            {"size": "S", "quantity": 6},
            {"size": "M", "quantity": 5},
            {"size": "XS", "quantity": 2},
            {"size": "XL", "quantity": 2},
            {"size": "L", "quantity": 2},
            {"size": "3XL", "quantity": 1},
            {"size": "XXL", "quantity": 0}
          ],
          "Ніжно-рожевий": [
            {"size": "S", "quantity": 12},
            {"size": "M", "quantity": 11},
            {"size": "L", "quantity": 8},
            {"size": "XL", "quantity": 2},
            {"size": "XXL", "quantity": 2},
            {"size": "XS", "quantity": 1},
            {"size": "3XL", "quantity": 0}
          ],
          "Бежевий": [
            {"size": "L", "quantity": 3},
            {"size": "S", "quantity": 3},
            {"size": "M", "quantity": 3},
            {"size": "XS", "quantity": 0},
            {"size": "XL", "quantity": 0},
            {"size": "XXL", "quantity": 0},
            {"size": "3XL", "quantity": 0}
          ],
          "Олива": [
            {"size": "L", "quantity": 8},
            {"size": "M", "quantity": 4},
            {"size": "XXL", "quantity": 1},
            {"size": "XS", "quantity": 0},
            {"size": "S", "quantity": 0},
            {"size": "XL", "quantity": 0},
            {"size": "3XL", "quantity": 0}
          ],
          "Сірий Грі": [
            {"size": "M", "quantity": 36},
            {"size": "L", "quantity": 28},
            {"size": "XL", "quantity": 20},
            {"size": "S", "quantity": 19},
            {"size": "XXL", "quantity": 8},
            {"size": "XS", "quantity": 1},
            {"size": "3XL", "quantity": 4}
          ],
          "Хакі": [
            {"size": "L", "quantity": 18},
            {"size": "M", "quantity": 17},
            {"size": "S", "quantity": 8},
            {"size": "XL", "quantity": 4},
            {"size": "XXL", "quantity": 2},
            {"size": "XS", "quantity": 1},
            {"size": "3XL", "quantity": 0}
          ],
          "Інший Колір": [
            {"size": "XS", "quantity": 0},
            {"size": "S", "quantity": 0},
            {"size": "M", "quantity": 0},
            {"size": "L", "quantity": 0},
            {"size": "XL", "quantity": 0},
            {"size": "XXL", "quantity": 0},
            {"size": "3XL", "quantity": 0}
          ]
        }
      },
      {
        "month": "Березень",
        "colors": {
          "Чорний": [
            {"size": "M", "quantity": 107},
            {"size": "L", "quantity": 86},
            {"size": "XL", "quantity": 51},
            {"size": "XXL", "quantity": 21},
            {"size": "S", "quantity": 20},
            {"size": "3XL", "quantity": 8},
            {"size": "XS", "quantity": 3}
          ],
          "Ніжно-рожевий": [
            {"size": "L", "quantity": 11},
            {"size": "M", "quantity": 13},
            {"size": "XL", "quantity": 9},
            {"size": "XS", "quantity": 1},
            {"size": "S", "quantity": 7},
            {"size": "XXL", "quantity": 0},
            {"size": "3XL", "quantity": 0}
          ],
          "Білий": [
            {"size": "L", "quantity": 3},
            {"size": "XL", "quantity": 1},
            {"size": "M", "quantity": 1},
            {"size": "XS", "quantity": 0},
            {"size": "S", "quantity": 0},
            {"size": "XXL", "quantity": 0},
            {"size": "3XL", "quantity": 0}
          ],
          "Бежевий": [
            {"size": "M", "quantity": 5},
            {"size": "L", "quantity": 4},
            {"size": "S", "quantity": 1},
            {"size": "XL", "quantity": 1},
            {"size": "XS", "quantity": 0},
            {"size": "XXL", "quantity": 0},
            {"size": "3XL", "quantity": 0}
          ],
          "Олива": [
            {"size": "XL", "quantity": 3},
            {"size": "XXL", "quantity": 2},
            {"size": "XS", "quantity": 0},
            {"size": "S", "quantity": 0},
            {"size": "M", "quantity": 0},
            {"size": "L", "quantity": 0},
            {"size": "3XL", "quantity": 0}
          ],
          "Сірий Грі": [
            {"size": "M", "quantity": 10},
            {"size": "L", "quantity": 10},
            {"size": "XL", "quantity": 6},
            {"size": "S", "quantity": 2},
            {"size": "XS", "quantity": 1},
            {"size": "XXL", "quantity": 1},
            {"size": "3XL", "quantity": 0}
          ],
          "Хакі": [
            {"size": "M", "quantity": 13},
            {"size": "L", "quantity": 10},
            {"size": "S", "quantity": 6},
            {"size": "XL", "quantity": 6},
            {"size": "XS", "quantity": 2},
            {"size": "XXL", "quantity": 1},
            {"size": "3XL", "quantity": 0}
          ],
          "Інший Колір": [
            {"size": "XS", "quantity": 0},
            {"size": "S", "quantity": 0},
            {"size": "M", "quantity": 0},
            {"size": "L", "quantity": 0},
            {"size": "XL", "quantity": 0},
            {"size": "XXL", "quantity": 0},
            {"size": "3XL", "quantity": 0}
          ]
        }
      },
      {
        "month": "Квітень",
        "colors": {
          "Чорний": [
            {"size": "L", "quantity": 29},
            {"size": "M", "quantity": 18},
            {"size": "XL", "quantity": 17},
            {"size": "S", "quantity": 11},
            {"size": "XXL", "quantity": 8},
            {"size": "3XL", "quantity": 2},
            {"size": "XS", "quantity": 0}
          ],
          "Ніжно-рожевий": [
            {"size": "L", "quantity": 2},
            {"size": "XXL", "quantity": 2},
            {"size": "S", "quantity": 1},
            {"size": "XL", "quantity": 1},
            {"size": "XS", "quantity": 0},
            {"size": "M", "quantity": 0},
            {"size": "3XL", "quantity": 0}
          ],
          "Білий": [
            {"size": "M", "quantity": 1},
            {"size": "L", "quantity": 1},
            {"size": "3XL", "quantity": 1},
            {"size": "XS", "quantity": 0},
            {"size": "S", "quantity": 0},
            {"size": "XL", "quantity": 0},
            {"size": "XXL", "quantity": 0}
          ],
          "Бежевий": [
            {"size": "L", "quantity": 2},
            {"size": "XXL", "quantity": 1},
            {"size": "XS", "quantity": 0},
            {"size": "S", "quantity": 0},
            {"size": "M", "quantity": 0},
            {"size": "XL", "quantity": 0},
            {"size": "3XL", "quantity": 0}
          ],
          "Олива": [
            {"size": "XL", "quantity": 2},
            {"size": "XS", "quantity": 0},
            {"size": "S", "quantity": 0},
            {"size": "M", "quantity": 0},
            {"size": "L", "quantity": 0},
            {"size": "XXL", "quantity": 0},
            {"size": "3XL", "quantity": 0}
          ],
          "Сірий Грі": [
            {"size": "L", "quantity": 3},
            {"size": "M", "quantity": 3},
            {"size": "XXL", "quantity": 1},
            {"size": "S", "quantity": 1},
            {"size": "XL", "quantity": 1},
            {"size": "XS", "quantity": 0},
            {"size": "3XL", "quantity": 0}
          ],
          "Хакі": [
            {"size": "L", "quantity": 10},
            {"size": "M", "quantity": 9},
            {"size": "XL", "quantity": 5},
            {"size": "S", "quantity": 3},
            {"size": "3XL", "quantity": 1},
            {"size": "XS", "quantity": 0},
            {"size": "XXL", "quantity": 0}
          ],
          "Інший Колір": [
            {"size": "XS", "quantity": 0},
            {"size": "S", "quantity": 0},
            {"size": "M", "quantity": 0},
            {"size": "L", "quantity": 0},
            {"size": "XL", "quantity": 0},
            {"size": "XXL", "quantity": 0},
            {"size": "3XL", "quantity": 0}
          ]
        }
      },
      {
        "month": "Травень",
        "colors": {
          "Чорний": [
            {"size": "M", "quantity": 23},
            {"size": "L", "quantity": 13},
            {"size": "XL", "quantity": 12},
            {"size": "XXL", "quantity": 3},
            {"size": "S", "quantity": 3},
            {"size": "3XL", "quantity": 1},
            {"size": "XS", "quantity": 0}
          ],
          "Білий": [
            {"size": "XL", "quantity": 1},
            {"size": "S", "quantity": 1},
            {"size": "M", "quantity": 1},
            {"size": "XXL", "quantity": 1},
            {"size": "L", "quantity": 1},
            {"size": "XS", "quantity": 0},
            {"size": "3XL", "quantity": 0}
          ],
          "Ніжно-рожевий": [
            {"size": "L", "quantity": 2},
            {"size": "M", "quantity": 2},
            {"size": "XL", "quantity": 1},
            {"size": "XS", "quantity": 0},
            {"size": "S", "quantity": 0},
            {"size": "XXL", "quantity": 0},
            {"size": "3XL", "quantity": 0}
          ],
          "Бежевий": [
            {"size": "M", "quantity": 2},
            {"size": "XXL", "quantity": 1},
            {"size": "L", "quantity": 1},
            {"size": "XS", "quantity": 0},
            {"size": "S", "quantity": 0},
            {"size": "XL", "quantity": 0},
            {"size": "3XL", "quantity": 0}
          ],
          "Олива": [
            {"size": "M", "quantity": 2},
            {"size": "XS", "quantity": 0},
            {"size": "S", "quantity": 0},
            {"size": "L", "quantity": 0},
            {"size": "XL", "quantity": 0},
            {"size": "XXL", "quantity": 0},
            {"size": "3XL", "quantity": 0}
          ],
          "Сірий Грі": [
            {"size": "XL", "quantity": 2},
            {"size": "L", "quantity": 2},
            {"size": "S", "quantity": 1},
            {"size": "XS", "quantity": 0},
            {"size": "M", "quantity": 0},
            {"size": "XXL", "quantity": 0},
            {"size": "3XL", "quantity": 0}
          ],
          "Хакі": [
            {"size": "L", "quantity": 9},
            {"size": "M", "quantity": 7},
            {"size": "XL", "quantity": 5},
            {"size": "S", "quantity": 4},
            {"size": "XS", "quantity": 1},
            {"size": "XXL", "quantity": 1},
            {"size": "3XL", "quantity": 0}
          ],
          "Інший Колір": [
            {"size": "XS", "quantity": 0},
            {"size": "S", "quantity": 0},
            {"size": "M", "quantity": 0},
            {"size": "L", "quantity": 0},
            {"size": "XL", "quantity": 0},
            {"size": "XXL", "quantity": 0},
            {"size": "3XL", "quantity": 0}
          ]
        }
      },
      {
        "month": "Червень",
        "colors": {
          "Чорний": [
            {"size": "M", "quantity": 9},
            {"size": "XXL", "quantity": 2},
            {"size": "S", "quantity": 2},
            {"size": "L", "quantity": 2},
            {"size": "XL", "quantity": 1},
            {"size": "3XL", "quantity": 1},
            {"size": "XS", "quantity": 1}
          ],
          "Білий": [
            {"size": "L", "quantity": 2},
            {"size": "XL", "quantity": 1},
            {"size": "S", "quantity": 1},
            {"size": "XS", "quantity": 0},
            {"size": "M", "quantity": 0},
            {"size": "XXL", "quantity": 0},
            {"size": "3XL", "quantity": 0}
          ],
          "Ніжно-рожевий": [
            {"size": "M", "quantity": 1},
            {"size": "XS", "quantity": 0},
            {"size": "S", "quantity": 0},
            {"size": "L", "quantity": 0},
            {"size": "XL", "quantity": 0},
            {"size": "XXL", "quantity": 0},
            {"size": "3XL", "quantity": 0}
          ],
          "Бежевий": [
            {"size": "L", "quantity": 3},
            {"size": "S", "quantity": 2},
            {"size": "XL", "quantity": 1},
            {"size": "M", "quantity": 1},
            {"size": "XS", "quantity": 0},
            {"size": "XXL", "quantity": 0},
            {"size": "3XL", "quantity": 0}
          ],
          "Олива": [
            {"size": "XS", "quantity": 0},
            {"size": "S", "quantity": 0},
            {"size": "M", "quantity": 0},
            {"size": "L", "quantity": 0},
            {"size": "XL", "quantity": 0},
            {"size": "XXL", "quantity": 0},
            {"size": "3XL", "quantity": 0}
          ],
          "Сірий Грі": [
            {"size": "L", "quantity": 4},
            {"size": "M", "quantity": 4},
            {"size": "XL", "quantity": 1},
            {"size": "XS", "quantity": 0},
            {"size": "S", "quantity": 0},
            {"size": "XXL", "quantity": 0},
            {"size": "3XL", "quantity": 0}
          ],
          "Хакі": [
            {"size": "M", "quantity": 1},
            {"size": "XXL", "quantity": 1},
            {"size": "L", "quantity": 1},
            {"size": "XS", "quantity": 0},
            {"size": "S", "quantity": 0},
            {"size": "XL", "quantity": 0},
            {"size": "3XL", "quantity": 0}
          ],
          "Інший Колір": [
            {"size": "XS", "quantity": 0},
            {"size": "S", "quantity": 0},
            {"size": "M", "quantity": 0},
            {"size": "L", "quantity": 0},
            {"size": "XL", "quantity": 0},
            {"size": "XXL", "quantity": 0},
            {"size": "3XL", "quantity": 0}
          ]
        }
      },
      {
        "month": "Серпень",
        "colors": {
          "Чорний": [
            {"size": "M", "quantity": 69},
            {"size": "L", "quantity": 53},
            {"size": "XL", "quantity": 47},
            {"size": "S", "quantity": 22},
            {"size": "XXL", "quantity": 22},
            {"size": "3XL", "quantity": 4},
            {"size": "XS", "quantity": 3}
          ],
          "Білий": [
            {"size": "L", "quantity": 4},
            {"size": "M", "quantity": 4},
            {"size": "S", "quantity": 2},
            {"size": "XL", "quantity": 1},
            {"size": "XS", "quantity": 0},
            {"size": "XXL", "quantity": 0},
            {"size": "3XL", "quantity": 0}
          ],
          "Ніжно-рожевий": [
            {"size": "M", "quantity": 28},
            {"size": "S", "quantity": 24},
            {"size": "L", "quantity": 13},
            {"size": "XS", "quantity": 11},
            {"size": "XL", "quantity": 1},
            {"size": "XXL", "quantity": 0},
            {"size": "3XL", "quantity": 0}
          ],
          "Бежевий": [
            {"size": "L", "quantity": 9},
            {"size": "M", "quantity": 8},
            {"size": "XL", "quantity": 6},
            {"size": "S", "quantity": 3},
            {"size": "XXL", "quantity": 3},
            {"size": "XS", "quantity": 1},
            {"size": "3XL", "quantity": 0}
          ],
          "Олива": [
            {"size": "XS", "quantity": 0},
            {"size": "S", "quantity": 0},
            {"size": "M", "quantity": 0},
            {"size": "L", "quantity": 0},
            {"size": "XL", "quantity": 0},
            {"size": "XXL", "quantity": 0},
            {"size": "3XL", "quantity": 0}
          ],
          "Сірий Грі": [
            {"size": "M", "quantity": 7},
            {"size": "L", "quantity": 6},
            {"size": "XL", "quantity": 6},
            {"size": "S", "quantity": 4},
            {"size": "XS", "quantity": 0},
            {"size": "XXL", "quantity": 0},
            {"size": "3XL", "quantity": 0}
          ],
          "Хакі": [
            {"size": "XL", "quantity": 9},
            {"size": "L", "quantity": 9},
            {"size": "M", "quantity": 8},
            {"size": "S", "quantity": 4},
            {"size": "XXL", "quantity": 3},
            {"size": "3XL", "quantity": 1},
            {"size": "XS", "quantity": 0}
          ],
          "Інший Колір": [
            {"size": "XS", "quantity": 0},
            {"size": "S", "quantity": 0},
            {"size": "M", "quantity": 0},
            {"size": "L", "quantity": 0},
            {"size": "XL", "quantity": 0},
            {"size": "XXL", "quantity": 0},
            {"size": "3XL", "quantity": 0}
          ]
        }
      }
    ]
  }
];

let salesChart;

// Define months in order
const months = salesData[0].months.map(m => m.month);

// Define colors and sizes
const colors = ['Чорний', 'Білий', 'Ніжно-рожевий', 'Бежевий', 'Олива', 'Сірий Грі', 'Хакі', 'Інший Колір'];
const sizes = ['XS', 'S', 'M', 'L', 'XL', 'XXL', '3XL'];

// Function to assign colors
function getColor(name) {
    const colorMap = {
        'Чорний': '#000000',
        'Білий': '#E0E0E0', // Changed from #FFFFFF to avoid blending with background
        'Ніжно-рожевий': '#FFC1CC',
        'Бежевий': '#F5F5DC',
        'Олива': '#808000',
        'Сірий Грі': '#808080',
        'Хакі': '#C3B091',
        'Інший Колір': '#FF00FF',
        'XS': '#FF6347',
        'S': '#4682B4',
        'M': '#32CD32',
        'L': '#FFD700',
        'XL': '#6A5ACD',
        'XXL': '#FF4500',
        '3XL': '#9ACD32'
    };
    return colorMap[name] || '#000000';
}

// Function to calculate total sales for a dataset
function calculateTotalSales(data) {
    return data.reduce((sum, value) => sum + value, 0);
}

// Function to update total sales display
function updateTotalSales(datasets) {
    const totalSalesDiv = document.getElementById('totalSales');
    let html = '<h3>Загальні суми продажів:</h3><ul>';
    datasets.forEach(dataset => {
        const total = calculateTotalSales(dataset.data);
        // Видалено дублювання "(Загалом: ...)" із мітки
        const label = dataset.label.split(' (Загалом:')[0]; // Беремо лише назву кольору/розміру
        html += `<li><span class="label">${label}</span><span class="value">${total}</span></li>`;
    });
    html += '</ul>';
    totalSalesDiv.innerHTML = html;
}

// Function to update chart based on selection
function updateChart() {
    const productSelect = document.getElementById('productSelect').value;
    const chartType = document.getElementById('chartType').value;
    const chartTitle = document.getElementById('chartTitle');

    // Find selected product data
    const productData = salesData.find(p => p.product === productSelect);
    if (!productData) return;

    let datasets = [];
    let titleText = '';

    if (chartType === 'byColor') {
        // Sales by color
        datasets = colors.map(color => {
            const data = productData.months.map(month => {
                return month.colors[color] ? month.colors[color].reduce((sum, item) => sum + item.quantity, 0) : 0;
            });
            return {
                label: color, // Видалено "(Загалом: ...)" із легенд
                data: data,
                backgroundColor: getColor(color),
                borderColor: getColor(color),
                borderWidth: 1
            };
        });
        titleText = `Продажі за кольором для ${productSelect} по місяцях`;
    } else {
        // Sales by size for selected color
        datasets = sizes.map(size => {
            const data = productData.months.map(month => {
                const colorData = month.colors[chartType];
                const item = colorData ? colorData.find(i => i.size === size) : null;
                return item ? item.quantity : 0;
            });
            return {
                label: size, // Видалено "(Загалом: ...)" із легенд
                data: data,
                backgroundColor: getColor(size),
                borderColor: getColor(size),
                borderWidth: 1
            };
        });
        titleText = `Продажі за розмірами для кольору ${chartType} (${productSelect}) по місяцях`;
    }

    // Update total sales display
    updateTotalSales(datasets);

    // Destroy previous chart if exists
    if (salesChart) {
        salesChart.destroy();
    }

    // Update chart title
    chartTitle.textContent = titleText;

    // Create new chart
    salesChart = new Chart(document.getElementById('salesChart'), {
        type: 'bar',
        data: {
            labels: months,
            datasets: datasets
        },
        options: {
            plugins: {
                title: {
                    display: true,
                    text: titleText
                },
                legend: {
                    position: 'top'
                },
                datalabels: {
                    anchor: 'end',
                    align: 'top',
                    formatter: (value, context) => {
                        return value > 0 ? value : '';
                    },
                    color: '#000',
                    font: {
                        weight: 'bold'
                    }
                }
            },
            scales: {
                x: {
                    title: {
                        display: true,
                        text: 'Місяць'
                    },
                    offset: true // Додає відступи для запобігання накладанню
                },
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Кількість проданих одиниць'
                    }
                }
            },
            barPercentage: 1.0, // Максимальна ширина окремого стовпчика
            categoryPercentage: 0.95, // Ширина групи стовпчиків
            maxBarThickness: 100 // Збільшено для ширших стовпчиків
        },
        plugins: [ChartDataLabels]
    });
}

// Initialize chart on page load
document.addEventListener('DOMContentLoaded', updateChart);